id: org.freedesktop.Sdk.Extension.texlive
branch: '19.08'
runtime: org.freedesktop.Sdk
build-extension: true
sdk: org.freedesktop.Sdk
runtime-version: '19.08'
appstream-compose: false
separate-locales: false
build-options:
  prefix: /usr/lib/sdk/texlive
  env:
    PATH: /usr/lib/sdk/texlive/bin:/usr/bin
modules:
  - name: texlive-source
    buildsystem: autotools
    builddir: true
    config-opts:
      - --bindir=${FLATPAK_DEST}/bin/${FLATPAK_ARCH}
      - --datarootdir=${FLATPAK_DEST}/share
      - --disable-xetex # needs additonal dependencies
      - --disable-xindy # needs additonal dependencies
      - --exec_prefix=${FLATPAK_DEST}
      - --includedir=${FLATPAK_DEST}/include
      - --infodir=${FLATPAK_DEST}/share/info
      - --libdir=${FLATPAK_DEST}/lib
      - --mandir=${FLATPAK_DEST}/share/man
      - --prefix=${FLATPAK_DEST}
      - --without-x # needs additonal dependencies
    # Hints for a proper installation can be found in http://www.linuxfromscratch.org/blfs/view/svn/pst/texlive.html or http://ftp.math.utah.edu/pub/texlive-utah/ .
    sources:
      - type: archive
        url: https://ftp.tu-chemnitz.de/pub/tug/historic/systems/texlive/2020/texlive-20200406-source.tar.xz
        sha256: e32f3d08cbbbcf21d8d3f96f2143b64a1f5e4cb01b06b761d6249c8785249078
#      - type: archive
#        url: https://ftp.tu-chemnitz.de/pub/tug/historic/systems/texlive/2020/texlive-20200406-texmf.tar.xz
#        sha256: 0aa97e583ecfd488e1dc60ff049fec073c1e22dfe7de30a3e4e8c851bb875a95
#        size: 3165595416
  - name: appdata
    buildsystem: simple
    build-commands:
      - mkdir -p ${FLATPAK_DEST}/share/appdata
      - cp org.freedesktop.Sdk.Extension.texlive.appdata.xml ${FLATPAK_DEST}/share/appdata
      - appstream-compose  --basename=org.freedesktop.Sdk.Extension.texlive --prefix=${FLATPAK_DEST} --origin=flatpak org.freedesktop.Sdk.Extension.texlive
    sources:
      - type: file
        path: org.freedesktop.Sdk.Extension.texlive.appdata.xml
  - name: scripts
    buildsystem: simple
    build-commands:
      - cp *.sh /usr/lib/sdk/texlive/
    sources:
      - type: script
        commands:
          - install -d /app/texlive
          - cp -ra /usr/lib/sdk/texlive/* /app/texlive
        dest-filename: install.sh
      - type: script
        commands:
          - export PATH=/usr/lib/sdk/texlive/bin/x86_64-linux:/usr/lib/sdk/texlive/bin:$PATH
        dest-filename: enable.sh
