From 827f4188c785a80199c9499122b04256667880bb Mon Sep 17 00:00:00 2001
From: John Bowman <bowman@ualberta.ca>
Date: Sun, 2 Jan 2022 11:15:20 -0700
Subject: [PATCH] Support compilation again without tirpc library (not
 recommended, as this will disable both XDR and V3D support).

---
 configure.ac   |  2 +-
 pair.h         |  3 +++
 prc/oPRCFile.h |  4 ++++
 settings.cc    | 12 ++++++------
 triple.h       |  3 +++
 5 files changed, 17 insertions(+), 7 deletions(-)

diff --git a/configure.ac b/configure.ac
index bec074a4c..b2b74bcca 100644
--- a/configure.ac
+++ b/configure.ac
@@ -384,7 +384,7 @@ AC_COMPILE_IFELSE([AC_LANG_PROGRAM([#include "xstream.h"])],
                    [AC_SEARCH_LIBS([xdrstdio_create],[nsl tirpc])
                     AC_DEFINE(HAVE_RPC_RPC_H,1,
                    DEFINE([a working <tirpc/rpc/rpc.h> header]))],
-   AC_MSG_WARN([*** Broken rpc headers; XDR support disabled ***]))
+   AC_MSG_WARN([*** Broken rpc headers; XDR/V3D support disabled ***]))
 
 AC_ARG_ENABLE(gsl,
 [AS_HELP_STRING(--enable-gsl[[[=yes]]],enable GNU Scientific Library)])
diff --git a/pair.h b/pair.h
index d9003839a..c94be1abb 100644
--- a/pair.h
+++ b/pair.h
@@ -21,7 +21,10 @@
 
 #include "common.h"
 #include "angle.h"
+
+#ifdef HAVE_RPC_RPC_H
 #include "xstream.h"
+#endif
 
 namespace camp {
 
diff --git a/prc/oPRCFile.h b/prc/oPRCFile.h
index 4a1ef8428..fc45e58fb 100644
--- a/prc/oPRCFile.h
+++ b/prc/oPRCFile.h
@@ -39,7 +39,11 @@
 #include "PRC.h"
 #include "PRCbitStream.h"
 #include "writePRC.h"
+
+
+#ifdef HAVE_RPC_RPC_H
 #include "xstream.h"
+#endif
 
 namespace prc {
 
diff --git a/settings.cc b/settings.cc
index ce5a5f8f4..de6acdcb6 100644
--- a/settings.cc
+++ b/settings.cc
@@ -1016,13 +1016,13 @@ struct versionOption : public option {
     feature("SSBO     GLSL shader storage buffer objects",ssbo);
     feature("GSL      GNU Scientific Library (special functions)",gsl);
     feature("FFTW3    Fast Fourier transforms",fftw3);
-    feature("XDR      external data representation (portable binary file format for V3D)",xdr);
+    feature("XDR      External Data Representation (portable binary file format for V3D)",xdr);
     feature("CURL     URL support",curl);
-    feature("lsp      language server protocol",lsp);
+    feature("LSP      Language Server Protocol",lsp);
     feature("Readline interactive history and editing",readline);
     if(!readline)
       feature("Editline interactive editing (if Readline is unavailable)",editline);
-    feature("Sigsegv  distinguish stack overflows from segmentation faults",
+    feature("Sigsegv  Distinguish stack overflows from segmentation faults",
             sigsegv);
     feature("GC       Boehm garbage collector",usegc);
   }
@@ -1364,9 +1364,9 @@ void initSettings() {
   addOption(new boolSetting("multiline", 0,
                             "Input code over multiple lines at the prompt"));
   addOption(new boolSetting("xasy", 0,
-                            "Special interactive mode for xasy"));
-  addOption(new boolSetting("lsp", 0, "Special interactive mode for lsp-rpc"));
-  addOption(new boolSetting("wsl", 0, "Set to WSL mode when running asy inside WSL."));
+                            "Interactive mode for xasy"));
+  addOption(new boolSetting("lsp", 0, "Interactive mode for the Language Server Protocol"));
+  addOption(new boolSetting("wsl", 0, "Run asy under the Windows Subsystem for Linux."));
   addOption(new envSetting("lspport", ""));
   addOption(new envSetting("lsphost", "127.0.0.1"));
 
diff --git a/triple.h b/triple.h
index c1639ceed..5cc4c2e96 100644
--- a/triple.h
+++ b/triple.h
@@ -18,7 +18,10 @@
 #include "common.h"
 #include "angle.h"
 #include "pair.h"
+
+#ifdef HAVE_RPC_RPC_H
 #include "xstream.h"
+#endif
 
 namespace camp {
 
