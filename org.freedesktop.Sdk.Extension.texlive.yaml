id: org.freedesktop.Sdk.Extension.texlive
branch: '18.08'
runtime: org.freedesktop.Sdk
build-extension: true
sdk: org.freedesktop.Sdk
runtime-version: '18.08'
appstream-compose: false
separate-locales: false
build-options:
  prefix: /usr/lib/sdk/texlive
  env:
    PATH: /usr/lib/sdk/texlive/bin:/usr/bin
modules:
- name: texlive
  buildsystem: simple
  sources:
    - type: svn
      url: svn://tug.org/texlive/branches/branch2019/Build/source
  build-commands:
    # has to be fixed by pulling in further depencies, see http://tug.org/texlive/doc/tlbuild.html#Prerequisites
    - ./Build --prefix=/usr/lib/sdk/texlive --without-x --disable-xetex --disable-xindy

- name: perl # required for makeglossaries
  no-autogen: true
  config-opts:
  - -des # use default build configuration
  - -Duseshrplib # build shared library
  build-options:
    cflags: -fPIC
    ldflags: -fpic
    no-debuginfo: true
  cleanup:
    - /man
    - "*.pod"
    - "*.h"
  sources:
  - type: archive
    url: https://www.cpan.org/src/5.0/perl-5.30.1.tar.gz
    sha256: bf3d25571ff1ee94186177c2cdef87867fd6a14aa5a84f0b1fb7bf798f42f964
  - type: script
    dest-filename: configure
    commands:
    - exec ./configure.gnu $@
    
- name: ghostscript # required for including .eps graphics
  config-opts:
  - --disable-cups
  build-options:
    ldflags: -L/app/lib
  sources:
  - type: archive
    url: https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs950/ghostscript-9.50.tar.xz
    sha256: db9bb0817b6f22974e6d5ad751975f346420c2c86a0afcfe6b4e09c47803e7d4
    
- name: appdata
  buildsystem: simple
  build-commands:
    - mkdir -p ${FLATPAK_DEST}/share/appdata
    - cp org.freedesktop.Sdk.Extension.texlive.appdata.xml ${FLATPAK_DEST}/share/appdata
    - appstream-compose  --basename=org.freedesktop.Sdk.Extension.texlive --prefix=${FLATPAK_DEST} --origin=flatpak org.freedesktop.Sdk.Extension.texlive
  sources:
  - type: file
    path: org.freedesktop.Sdk.Extension.texlive.appdata.xml

- name: scripts
  buildsystem: simple
  build-commands:
  - cp *.sh /usr/lib/sdk/texlive/
  sources:
  - type: script
    commands:
    - install -d /app/texlive
    - cp -ra /usr/lib/sdk/texlive/* /app/texlive
    dest-filename: install.sh
  - type: script
    commands:
    - export PATH=/usr/lib/sdk/texlive/bin/x86_64-linux:/usr/lib/sdk/texlive/bin:$PATH
    dest-filename: enable.sh
